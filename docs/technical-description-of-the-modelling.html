<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Remote Sensing of Foliar Nitrogen in Californian Almonds - 6&nbsp; Technical description of the modelling</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./results-of-the-model-performances.html" rel="next">
<link href="./describing-processing-and-inspecting-the-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a href="https://damianoswald.com/index.html" class="navbar-brand navbar-brand-logo">
    <img src="./resources/iconDO.png" alt="" class="navbar-logo">
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto tools-wide">
    <a href="https://github.com/damian-oswald/master-thesis/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Remote-Sensing-of-Foliar-Nitrogen-in-Californian-Almonds.pdf" rel="" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./technical-description-of-the-modelling.html"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Technical description of the modelling</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./background.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Background</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./vegetation-indices-based-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Vegetation-indices-based methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./machine-learning-methods-for-hyperspectral-data-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Machine learning methods for hyperspectral data analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./radiative-transfer-models.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Radiative transfer models</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./describing-processing-and-inspecting-the-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Describing, processing and inspecting the data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./technical-description-of-the-modelling.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Technical description of the modelling</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./results-of-the-model-performances.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Results of the model performances</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./discussion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Discussion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./conclusion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Conclusion</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./appendix.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Appendix</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#modelling-with-hand-crafted-features" id="toc-modelling-with-hand-crafted-features" class="nav-link active" data-scroll-target="#modelling-with-hand-crafted-features"><span class="header-section-number">6.1</span> Modelling with hand-crafted features</a></li>
  <li><a href="#sec-hypertuning" id="toc-sec-hypertuning" class="nav-link" data-scroll-target="#sec-hypertuning"><span class="header-section-number">6.2</span> Training the machine learning models</a></li>
  <li><a href="#running-the-radiative-transfer-models" id="toc-running-the-radiative-transfer-models" class="nav-link" data-scroll-target="#running-the-radiative-transfer-models"><span class="header-section-number">6.3</span> Running the radiative transfer models</a>
  <ul class="collapse">
  <li><a href="#leaf-level-radiative-modelling" id="toc-leaf-level-radiative-modelling" class="nav-link" data-scroll-target="#leaf-level-radiative-modelling">Leaf level radiative modelling</a></li>
  <li><a href="#canopy-level-radiative-modelling" id="toc-canopy-level-radiative-modelling" class="nav-link" data-scroll-target="#canopy-level-radiative-modelling">Canopy level radiative modelling</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/damian-oswald/master-thesis/blob/main/technical-description-of-the-modelling.qmd" class="toc-action">View source</a></p><p><a href="https://github.com/damian-oswald/master-thesis/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span id="sec-modelling" class="quarto-section-identifier"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Technical description of the modelling</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>In this chapter, the focus lies on exploring the process of modelling crop nitrogen at both the leaf and canopy levels. To guarantee a just and impartial comparison of the various modelling techniques, all models were provided with identical data — insofar they can make use of it. Furthermore, a machine learning paradigm was employed not solely for the training of machine learning models, but also for all models involved. As a result, certain parameters of the hand-crafted feature approach or the radiative transfer modelling approach were considered as hyperparameters and selected through cross-validation (this will be explained in more detail in <a href="#sec-hypertuning">section&nbsp;<span>6.2</span></a>).</p>
<p>An extensive comparison was carried out, examining a total of 23 different models for their effectiveness. It is relevant to acknowledge that there is a considerable overlap among some of these models. A comprehensive list of the evaluated models can be found in <a href="#tbl-ModellingApproaches">table&nbsp;<span>6.1</span></a>, where the method names in the third column are consistently used in subsequent plots and tables to simplify referencing and interpreting the results.</p>
<div id="tbl-ModellingApproaches" class="anchored">
<table class="table">
<caption>Table&nbsp;6.1: Here, an overview of the modelling techniques that were evaluated is presented. It is worth noting that the precise definitions of the vegetation indices mentioned below are available in <a href="vegetation-indices-based-methods.html#tbl-VegetationIndices">table&nbsp;<span>2.1</span></a>.</caption>
<colgroup>
<col style="width: 30%">
<col style="width: 30%">
<col style="width: 40%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Approach</strong></th>
<th><strong>Group</strong></th>
<th><strong>Method</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Hand-crafted features</td>
<td>Single vegetation indices</td>
<td>NDVI<br>
NDRE<br>
EVI<br>
GCI<br>
GNDVI<br>
MCARI<br>
RECI<br>
TCARI<br>
WDRVI<br>
R434</td>
</tr>
<tr class="even">
<td></td>
<td>Stepwise selection</td>
<td>Combined vegetation indices<br>
Recursive feature selection<br>
Square feature selection</td>
</tr>
<tr class="odd">
<td>Machine learning</td>
<td>Regularized least squares</td>
<td>Lasso<br>
Ridge<br>
Elastic net</td>
</tr>
<tr class="even">
<td></td>
<td>Dimensionality reduction</td>
<td>Principal component<br>
Partial least squares</td>
</tr>
<tr class="odd">
<td></td>
<td>Tree-based learning</td>
<td>Random forests<br>
Extreme gradient boosting<br>
Cubist</td>
</tr>
<tr class="even">
<td>Radiative transfer modelling</td>
<td>Leaf-level<br>
Canopy-level</td>
<td><span class="smallcaps">Prospect Pro</span><br>
<span class="smallcaps">Less</span><br>
<span class="smallcaps">Less</span> + interpolation</td>
</tr>
</tbody>
</table>
</div>
<section id="modelling-with-hand-crafted-features" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="modelling-with-hand-crafted-features"><span class="header-section-number">6.1</span> Modelling with hand-crafted features</h2>
<p>This section presents the approaches taken to model crop nitrogen by employing vegetation indices. Ten relevant vegetation indices were computed according to the equations specified in <a href="vegetation-indices-based-methods.html#tbl-VegetationIndices">table&nbsp;<span>2.1</span></a>. While a myriad of vegetation indices exist to model various plant traits, the focus in this thesis was placed on indices that have been utilized for modelling crop nitrogen in scientific literature, as documented by <span class="citation" data-cites="herrmann2010swir">Herrmann et al. (<a href="references.html#ref-herrmann2010swir" role="doc-biblioref">2010</a>)</span> and <span class="citation" data-cites="tian2011assessing">Tian et al. (<a href="references.html#ref-tian2011assessing" role="doc-biblioref">2011</a>)</span>. Upon calculating the vegetation indices, a simple linear regression model was fitted using ordinary least squares regression. Consequently, every model within the <em>single vegetation indices</em> group in <a href="#tbl-ModellingApproaches">table&nbsp;<span>6.1</span></a> has only two parameters: an intercept (<span class="math inline">\(\beta_0\)</span>) and a slope (<span class="math inline">\(\beta_1\)</span>).</p>
<p>Moreover, multiple linear regression models were evaluated, with all of the vegetation indices initially available. To prevent overfitting, stepwise selection was employed to choose a suitable subset from all the vegetation indices. Utilizing the Bayesian information criterion (<a href="machine-learning-methods-for-hyperspectral-data-analysis.html#eq-AIC">Equation&nbsp;<span>3.3</span></a> with <span class="math inline">\(k = \ln n\)</span>) resulted in superior model performance compared to using the Akaike information criterion. The stepwise regression was executed with the <code>step</code> function from the R package <code>stats</code> <span class="citation" data-cites="R2022">(<a href="references.html#ref-R2022" role="doc-biblioref">R Core Team 2022</a>)</span>, where sequential replacement was the specific strategy of choice (<code>direction = "both"</code>).</p>
<p>Stepwise selection was also employed as a strategy to identify a suitable subset of bands for a multiple linear model. However, this approach was only used after implementing other algorithms that initially chose a smaller subset of bands from the original data. This was due to the declining performance of stepwise selection as the number of variables added to the model increases <span class="citation" data-cites="hastie2017extended">(<a href="references.html#ref-hastie2017extended" role="doc-biblioref">Hastie et al. 2017</a>)</span>. Consequently, two algorithms that generate a prior subset of bands were examined in the context of this thesis: the recursive feature selection algorithm and the square feature selection algorithm. Both aim to identify bands that exhibit minimal correlation with one another, and both rely on the covariance matrix (<span class="math inline">\(\boldsymbol \Sigma\)</span>) of the z-score normalized data for this purpose.</p>
<p>The recursive feature selection algorithm is a straightforward method that iteratively selects bands with the highest pairwise covariance from <span class="math inline">\(\boldsymbol \Sigma\)</span>, eliminating the one with a higher shared covariance among all other bands. This process is repeated until the dataset is reduced to the desired <span class="math inline">\(d\)</span> dimensions. To refine this approach, <span class="math inline">\(d\)</span> was treated as a hyperparameter and chosen using cross-validation (<a href="#tbl-hyperparameters">Table&nbsp;<span>6.2</span></a>).</p>
<div id="fig-FeatureSelection" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="resources/CovarianceMatrix.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6.1: The square feature selection algorithm selects bands based on the covariance matrix (<span class="math inline">\(\boldsymbol \Sigma\)</span>). It attempts to fit a square within the area of <span class="math inline">\(\boldsymbol \Sigma\)</span> that is larger than a predetermined threshold. In this instance, the square feature selection algorithm was applied to the canopy-level reflectance (<strong>A</strong>), leaf-level reflectance (<strong>B</strong>), and leaf-level transmittance (<strong>C</strong>), respectively. The threshold employed for this illustration was <span class="math inline">\(s = 0.95\)</span>, corresponding to the white areas on the matrix diagonals. The numbering of the squares refers to their ordered size. All axes on these plots indicate the wavelength in nanometres.</figcaption>
</figure>
</div>
<p>On the other hand, the square feature selection algorithm seeks to identify a square subset centred on the diagonal of <span class="math inline">\(\boldsymbol \Sigma\)</span>, with the constraint that the square may only contain covariance values larger than a specific threshold <span class="math inline">\(s\)</span> (<a href="#fig-FeatureSelection">Figure&nbsp;<span>6.1</span></a>). The centre of the largest possible square corresponds to the selected band. All bands within that square are then removed from <span class="math inline">\(\mathbf X\)</span>, and the procedure is repeated <span class="math inline">\(d\)</span> times to find <span class="math inline">\(d\)</span> uncorrelated bands. As a result, in this implementation, both <span class="math inline">\(s\)</span> and <span class="math inline">\(d\)</span> were treated as hyperparameters that required fine-tuning. The optimal combinations of parameters derived from this fine-tuning process are presented in <a href="#tbl-hyperparameters">table&nbsp;<span>6.2</span></a>.</p>
</section>
<section id="sec-hypertuning" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="sec-hypertuning"><span class="header-section-number">6.2</span> Training the machine learning models</h2>
<p>In general, numerous machine learning models possess the flexibility to fit any given data perfectly. However, the ultimate objective is not a perfect fit but to accurately approximate the true data generating function. To prevent overfitting, these models typically employ parameters that regulate their complexity or the scale of estimated parameters. These parameters, referred to as hyperparameters, are distinct from the model’s internal parameters, as they must be explicitly defined. The optimization of hyperparameters plays a crucial role in ensuring the effective performance of machine learning models. To circumvent overfitting, data is typically divided randomly into training and validation sets. Models are calibrated using the training set, while performance metrics are assessed on the validation set. This approach can lead to noisy performance estimates, particularly in smaller datasets, depending on the arbitrary data split. Consequently, cross-validation has become a widely adopted technique, wherein the dataset <span class="math inline">\(\mathcal D\)</span> is partitioned into <span class="math inline">\(K\)</span> folds. For each fold <span class="math inline">\(k \in \{1,2,\dots,K\}\)</span>, a model <span class="math inline">\(f\)</span> is trained based on <span class="math inline">\(\mathcal D_{\lnot k}\)</span> and validated on <span class="math inline">\(\mathcal D_{k}\)</span>. To further increase the stability of the results, this process may be repeated <span class="math inline">\(r\)</span> times <span class="citation" data-cites="stone1974cross">(<a href="references.html#ref-stone1974cross" role="doc-biblioref">Stone 1974</a>)</span>. Ultimately, the average performance across all folds and repetitions can be employed to assess the model’s effectiveness.</p>
<p>The optimized hyperparameters for the machine learning models can be found in <a href="#tbl-hyperparameters">table&nbsp;<span>6.2</span></a>. These models were developed utilizing the statistical software and programming language R, in conjunction with a variety of packages such as <code>stats</code>, <code>caret</code>, <code>pls</code>, <code>randomForest</code>, <code>xgboost</code>, and <code>Cubist</code> <span class="citation" data-cites="R2022 kuhn2022caret liland2022pls chen2022 kuhn2023 liaw2002randomForest">(<a href="references.html#ref-liaw2002randomForest" role="doc-biblioref">Liaw and Wiener 2002</a>, <a href="references.html#ref-chen2022" role="doc-biblioref">Chen et al. 2022</a>, <a href="references.html#ref-kuhn2022caret" role="doc-biblioref">Kuhn 2022</a>, <a href="references.html#ref-liland2022pls" role="doc-biblioref">Liland et al. 2022</a>, <a href="references.html#ref-R2022" role="doc-biblioref">R Core Team 2022</a>, <a href="references.html#ref-kuhn2023" role="doc-biblioref">Kuhn and Quinlan 2023</a>)</span>.</p>
<div id="tbl-hyperparameters" class="anchored">
<table class="table">
<caption>Table&nbsp;6.2: List of hyperparameters for the feature selection and machine learning algorithms. The optimized hyperparameters are individually provided for the leaf-level data (LL) both for area- and mass-based nitrogen, and for the canopy-level data (CL).</caption>
<colgroup>
<col style="width: 37%">
<col style="width: 27%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Method</strong></th>
<th><strong>Parameter range</strong></th>
<th><strong>LL</strong> (N<sub>area</sub>)</th>
<th><strong>LL</strong> (N<sub>%</sub>)</th>
<th><strong>CL</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Recursive feature selection</td>
<td><span class="math inline">\(d \in [2,10]\)</span><br>
</td>
<td>9</td>
<td>8</td>
<td>4</td>
</tr>
<tr class="even">
<td>Square feature selection</td>
<td><span class="math inline">\(d \in [2,10]\)</span><br>
<span class="math inline">\(s \in [0.8,1]\)</span><br>
</td>
<td>7<br>
0.86<br>
</td>
<td>7<br>
0.92<br>
</td>
<td>6<br>
0.91</td>
</tr>
<tr class="odd">
<td>Lasso</td>
<td><span class="math inline">\(\lambda \in [10^{-5},1]\)</span><br>
</td>
<td>10<sup>-5</sup></td>
<td>10<sup>-5</sup></td>
<td>0.0063</td>
</tr>
<tr class="even">
<td>Ridge</td>
<td><span class="math inline">\(\lambda \in [10^{-5},1]\)</span><br>
</td>
<td>0.0141</td>
<td>10<sup>-5</sup></td>
<td>0.0063</td>
</tr>
<tr class="odd">
<td>Elastic-net</td>
<td><span class="math inline">\(\lambda \in [10^{-5},1]\)</span><br>
<span class="math inline">\(\alpha \in [0,1]\)</span><br>
</td>
<td>10<sup>-5</sup><br>
0.94</td>
<td>0.001<br>
1</td>
<td>0.0398<br>
0.1</td>
</tr>
<tr class="even">
<td>Principal components</td>
<td><span class="math inline">\(l \in [1,50]\)</span><br>
</td>
<td>19</td>
<td>19</td>
<td>5</td>
</tr>
<tr class="odd">
<td>Partial least squares</td>
<td><span class="math inline">\(l \in [1,50]\)</span><br>
</td>
<td>13</td>
<td>16</td>
<td>4</td>
</tr>
<tr class="even">
<td>Random forest</td>
<td><code>ntree</code> <span class="math inline">\(\in [50,5000]\)</span><br>
<code>nodesize</code> <span class="math inline">\(\in [1,5]\)</span><br>
</td>
<td>500<br>
3<br>
</td>
<td>500<br>
3<br>
</td>
<td>500<br>
5<br>
</td>
</tr>
<tr class="odd">
<td>Extreme gradient boosting</td>
<td><span class="math inline">\(\eta \in [0.01,1]\)</span><br>
<code>max_depth</code> <span class="math inline">\(\in [1,10]\)</span><br>
</td>
<td>0.3<br>
2<br>
</td>
<td>0.1<br>
2<br>
</td>
<td>0.1<br>
1<br>
</td>
</tr>
<tr class="even">
<td>Cubist</td>
<td><code>rules</code> <span class="math inline">\(\in [2,5]\)</span><br>
<code>committees</code> <span class="math inline">\(\in [1,20]\)</span></td>
<td>2<br>
10</td>
<td>2<br>
20</td>
<td>2<br>
20</td>
</tr>
</tbody>
</table>
</div>
</section>
<section id="running-the-radiative-transfer-models" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="running-the-radiative-transfer-models"><span class="header-section-number">6.3</span> Running the radiative transfer models</h2>
<p>Establishing the radiative transfer models proved to be the most labour-intensive task among all modelling approaches. This can be attributed to the highly specialized nature of these models, coupled with the scarcity of guidance available for their application, particularly at the canopy level.</p>
<section id="leaf-level-radiative-modelling" class="level3">
<h3 class="anchored" data-anchor-id="leaf-level-radiative-modelling">Leaf level radiative modelling</h3>
<p>At the leaf level, radiative transfer modelling was conducted utilizing <span class="smallcaps">Prospect-Pro</span>, which is available as one of the functions incorporated within the R package <code>prospect</code> <span class="citation" data-cites="feret2022package">(<a href="references.html#ref-feret2022package" role="doc-biblioref">Féret and de Boissieu 2022</a>)</span>. Generally, the most favourable results were obtained by employing the inversion technique of optimal spectral subdomains, as proposed by <span class="citation" data-cites="spafford2021spectral">Spafford et al. (<a href="references.html#ref-spafford2021spectral" role="doc-biblioref">2021</a>)</span>. This method enhances model inversion by concentrating on spectral subdomains for each constituent and maximizing the fit within that range, rather than over the entire spectrum.</p>
<div id="tbl-range" class="anchored">
<table class="table">
<caption>Table&nbsp;6.3: Parameter search range for both a conservative parameter estimation and a relaxed parameter estimation with wider lower- and upper bounds.</caption>
<colgroup>
<col style="width: 36%">
<col style="width: 34%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Conservative</strong></th>
<th><strong>Relaxed</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Leaf structure parameter</td>
<td><span class="math inline">\(N\in[1.5,2.5]\)</span></td>
<td><span class="math inline">\(N\in[1,3]\)</span></td>
</tr>
<tr class="even">
<td>Chlorophyll content<br>
Carotenoid content<br>
Anthocyanin content<br>
Tannin content<br>
Equivalent water thickness<br>
Protein content<br>
Carbon-based constituents</td>
<td><code>CHL</code> <span class="math inline">\(\in[0,60]\)</span><br>
<code>CAR</code> <span class="math inline">\(\in[0,15]\)</span><br>
<code>ANT</code> <span class="math inline">\(\in[0,7.5]\)</span><br>
<code>BROWN</code> <span class="math inline">\(= 0\)</span><br>
<code>EWT</code> <span class="math inline">\(\in[0.004,0.012]\)</span><br>
<code>PROT</code> <span class="math inline">\(\in[0.0004,0.005]\)</span><br>
<code>CBC</code> <span class="math inline">\(\in[0.001,0.002]\)</span></td>
<td><code>CHL</code> <span class="math inline">\(\in[0,80]\)</span><br>
<code>CAR</code> <span class="math inline">\(\in[0,20]\)</span><br>
<code>ANT</code> <span class="math inline">\(\in[0,10]\)</span><br>
<code>BROWN</code> <span class="math inline">\(= 0\)</span><br>
<code>EWT</code> <span class="math inline">\(\in[0,0.03]\)</span><br>
<code>PROT</code> <span class="math inline">\(\in[0,0.02]\)</span><br>
<code>CBC</code> <span class="math inline">\(\in[0,0.02]\)</span></td>
</tr>
<tr class="odd">
<td>Maximum incident angle</td>
<td><span class="math inline">\(\alpha = 40\)</span></td>
<td><span class="math inline">\(\alpha = 40\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>During the initial modelling phase, relatively restrictive box constraints were imposed on the parameters, meaning that no parameter was permitted to exceed the range specified in <a href="#tbl-range">table&nbsp;<span>6.3</span></a>. Possible correlations among parameters were disregarded for constraining the search space. The conservative parameter range was derived from <span class="citation" data-cites="camino2021detection">Camino et al. (<a href="references.html#ref-camino2021detection" role="doc-biblioref">2021</a>)</span>, who retrieved the same parameters from almonds for detecting <em>Xylella fastidiosa</em>.</p>
<p>Nonetheless, as many parameters retrieved by <span class="smallcaps">Prospect-Pro</span> in this phase resided at the lower or upper bounds, the parameter restrictions were relaxed in a subsequent phase. Parameters obtained under relaxed constraints generally resulted in a better alignment between simulated and observed data, as well as improved leaf-level predictions of foliar nitrogen concentration. Interestingly, reduced discrepancies between simulated and observed data did not consistently lead to enhanced nitrogen predictions. For instance, increasing the maximum incident angle <span class="math inline">\(\alpha\)</span> in <span class="smallcaps">Prospect-Pro</span> to <span class="math inline">\(\alpha = 80^\circ\)</span> decreased the difference between simulated and observed data, but worsened predictions of the foliar nitrogen concentration based on the retrieved parameters. Consequently, the maximum incident angle was set to <span class="math inline">\(\alpha = 40^\circ\)</span> as proposed by <span class="citation" data-cites="feret2008prospect">Féret et al. (<a href="references.html#ref-feret2008prospect" role="doc-biblioref">2008</a>)</span>.</p>
<p>After successfully retrieving the plant parameters, they needed to be associated with the measured nitrogen labels. This was accomplished by employing stepwise selection to a multiple linear model, which allowed for the inclusion of all plant parameters as input variables. The fundamental assumption here is that the foliar nitrogen concentration can be modelled as a linear response to the concentrations of chlorophyll and protein.</p>
</section>
<section id="canopy-level-radiative-modelling" class="level3">
<h3 class="anchored" data-anchor-id="canopy-level-radiative-modelling">Canopy level radiative modelling</h3>
<p>To model radiative transfer at the canopy level, the ray tracing model <span class="smallcaps">Less</span> was adapted. This three-dimensional forest scene simulator offers a freely accessible graphical user interface (GUI) and can be downloaded via the model’s website (<a href="https://lessrt.org" class="uri">https://lessrt.org</a>). Unfortunately, <span class="smallcaps">Less</span> does not provide an application programming interface (API), limiting customization possibilities for the simulations.</p>
<p>A virtual scene of an almond tree, where reflectance may interact with neighbouring trees and the soil, was created using a single three-dimensional model of an almond tree. This model was obtained from the <a href="https://www.cgtrader.com/">cgtrader</a> platform, where it was sold by the anonymous artist <span class="smallcaps">XFrog</span>. <span class="smallcaps">Less</span> enables users to upload any <code>.obj</code> file and arrange the objects as desired. Thus, a typical orchard scene could be recreated in <span class="smallcaps">Less</span>, with a central focus tree surrounded by 24 other trees in a 5 × 5 grid design. The trees were aligned similarly to the average trees in the Westwind orchard, with an inter-row distance of 6.73 m and a distance of 4.56 m between trees along the rows. The generated data cubes had dimensions of 56 × 38 × 200 = 425’600 values, closely corresponding to the average dimensions of the cropped hyperspectral images. The simulated image was specified to be orthographic, akin to the georectified real image (<a href="#fig-lessmodelling">Figure&nbsp;<span>6.2</span></a>).</p>
<div id="fig-lessmodelling" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="resources/LESS.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Figure&nbsp;6.2: Illustration of the three-dimensional object of an almond tree used in the simulation (<strong>A</strong>) and the model’s alignment to replicate the orchard scene (<strong>B</strong>). To generate predictions with <span class="smallcaps">Less</span>, observed hyperspectral images (<strong>C</strong>) must be compared with simulated hyperspectral images (<strong>D</strong>). It is important to note that the two images shown here are RGB reconstructions derived from hyperspectral data.</figcaption>
</figure>
</div>
<p><span class="smallcaps">Less</span> requires defining camera settings that closely approximate the actual settings on the day of data capture. In order to recreate the conditions of the data capture, the camera distance to the ground was set at 100 m above ground level. Simulated spectral bands were configured to align with those from the hyperspectral data. The view zenith angle and view azimuth angle were set to 0° and 180°, respectively. The solar zenith angle was set to 20°, while the solar azimuth angle was set to 240°. Sky cloudiness was not considered.</p>
<p>The hyperspectral signatures of leaves in the scene were based on the simulated spectral reflectance and transmittance of <span class="smallcaps">Prospect-D</span>. Given that the hyperspectral data did not encompass the short-wave-infrared spectrum, there was no need for <span class="smallcaps">Prospect-Pro</span> and its ability to simulate absorption caused by protein. The soil in the simulated scene was assigned the same reflectance as the bare soil in the hyperspectral images of the orchard.</p>
<p><span class="smallcaps">Less</span> generates output files of simulated radiance in the <code>.bsq</code> format, which closely resembles the data captured by the hyperspectral camera. Consequently, the output of <span class="smallcaps">Less</span> had to undergo similar processing steps as real observations to obtain comparable results: calculating reflectance from radiance and irradiance, semantically segmenting the hyperspectral image, and ultimately computing the mean reflectance of the bright canopy. As a result, a single simulated hyperspectral image from <span class="smallcaps">Less</span> could be reduced to a vector of reflectance data — represented as one row in the generated look-up table.</p>
<p>The look-up table was constructed by running <span class="smallcaps">Less</span> for numerous parameter combinations (<a href="#tbl-LessParameters">Table&nbsp;<span>6.4</span></a>), with the parameter ranges informed by the retrieved leaf-level ranges. The leaf area index (LAI) was the sole parameter not retrieved by <span class="smallcaps">Prospect-D</span>. This parameter was controlled exclusively by the size of the trees in the scene, resulting in a reduced leaf area over the same ground. All generated hyperspectral images were subsequently condensed to their reflectance vectors and stored as rows in a large matrix. This matrix effectively functions as the look-up table, as the exact parameters generating each reflectance entry are known and stored in a separate parameter matrix.</p>
<div id="tbl-LessParameters" class="anchored">
<table class="table">
<caption>Table&nbsp;6.4: The selected parameters for the look-up table generated using <span class="smallcaps">Less</span>. Each possible combination of these parameters was simulated once.</caption>
<colgroup>
<col style="width: 35%">
<col style="width: 65%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Parameter</strong></th>
<th><strong>Parameter range</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Chlorophyll</td>
<td><code>CHL</code> <span class="math inline">\(\in \{20, 22.5, 25, 27.5, 30, 32.5, 35, 37.5, 40, 42.5, 45\}\)</span></td>
</tr>
<tr class="even">
<td>Anthocyanin</td>
<td><code>ANT</code> <span class="math inline">\(\in \{2.75, 3.00, 3.25, 3.5, 3.75\}\)</span></td>
</tr>
<tr class="odd">
<td>Carotenoid</td>
<td><code>CAR</code> <span class="math inline">\(\in \{2.0, 3.0, 4.0, 5.0, 6.0\}\)</span></td>
</tr>
<tr class="even">
<td>Carbon-based constituents</td>
<td><code>CBC</code> <span class="math inline">\(\in \{0.006, 0.007, 0.008, 0.009, 0.010\}\)</span></td>
</tr>
<tr class="odd">
<td>Leaf area index</td>
<td><code>LAI</code> <span class="math inline">\(\in \{1,2,3,4,5,6,7,8,9,10,11,12,13,14,15 \}\)</span></td>
</tr>
</tbody>
</table>
</div>
<p>The look-up table <span class="math inline">\(\mathbf L\)</span> can be used to make a prediction for a single observation <span class="math inline">\(\mathbf x\)</span> by identifying the closest match between the observed and simulated reflectance based on a specific cost function <span class="math inline">\(J\)</span>. The most direct approach to this involves minimizing the Euclidean norm of the error between the <span class="math inline">\(i\)</span><sup>th</sup> simulation in the look-up table <span class="math inline">\(\mathbf L_{(i)}\)</span> and the observation <span class="math inline">\(\mathbf x\)</span>.</p>
<p><span id="eq-LUTminimization"><span class="math display">\[J(i) = \| \mathbf L_{(i)} - \mathbf x \|_2^2
\qquad
i^* = \arg \min_{i \in \{1 .. d\}} J(i) \tag{6.1}\]</span></span></p>
<p>In this context, <span class="math inline">\(i\)</span> represents the index of the simulated reflectance, and <span class="math inline">\(d\)</span> denotes the total number of simulations in the look-up table. To ensure a consistent treatment of the error, it is crucial that both the look-up table and the observed reflectance undergo z-score normalization prior to determining <span class="math inline">\(i^*\)</span>.</p>
<p>A straightforward method for performing regression using the look-up table <span class="math inline">\(\mathbf L\)</span> involves calculating the cost <span class="math inline">\(J\)</span> with respect to a single observation for each row in <span class="math inline">\(\mathbf L\)</span>, and then selecting <span class="math inline">\(i^*\)</span> associated with the lowest cost <span class="math inline">\(J(i)\)</span> as written in <a href="#eq-LUTminimization">equation&nbsp;<span>6.1</span></a>. Given that the parameter matrix is <span class="math inline">\(\mathbf P\)</span>, the retrieved parameters are <span class="math inline">\(\mathbf P_{(i^*)}\)</span>, or the parameters in the <span class="math inline">\(i^*\)</span><sup>th</sup> row of <span class="math inline">\(\mathbf P\)</span>. This implies that the retrieved parameters may only be any combination of those listed in <a href="#tbl-LessParameters">table&nbsp;<span>6.4</span></a>, resulting in discrete predictions.</p>
<p>To enable the retrieval of continuous parameters, a hyper-dimensional interpolation must be applied to the look-up table. This involves modelling the cost <span class="math inline">\(J\)</span> with respect to a single observation as a function of the parameters, an approach known as surrogate modelling <span class="citation" data-cites="gramacy2020surrogates">(<a href="references.html#ref-gramacy2020surrogates" role="doc-biblioref">Gramacy 2020</a>)</span>. Gaussian processes would be the most mathematically elegant surrogate model; however, due to their computational inefficiency, a multicubic polynomial surrogate model was chosen instead.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> To facilitate surrogate modelling, a subset of the parameter matrix <span class="math inline">\(\mathbf P\)</span> was created after computing <span class="math inline">\(J\)</span>, which includes only the closest neighbours of the found parameters <span class="math inline">\(\mathbf P_{(i^*)}\)</span>. The multicubic polynomial was fitted to this subset to model <span class="math inline">\(J\)</span> as a response to the parameters, allowing for easy minimization and therefore the retrieval of smooth parameters.</p>


<div id="refs" class="references csl-bib-body hanging-indent" data-line-spacing="2" role="list" style="display: none">
<div id="ref-camino2021detection" class="csl-entry" role="listitem">
Camino, C., R. Calderón, S. Parnell, H. Dierkes, Y. Chemin, M. Román-Écija, M. Montes-Borrego, B. B. Landa, J. A. Navas-Cortes, P. J. Zarco-Tejada, and others. 2021. <a href="https://doi.org/10.1016/j.rse.2021.112420">Detection of xylella fastidiosa in almond orchards by synergic use of an epidemic spread model and remotely sensed plant traits</a>. Remote Sensing of Environment 260:112420.
</div>
<div id="ref-chen2022" class="csl-entry" role="listitem">
Chen, T., T. He, M. Benesty, V. Khotilovich, Y. Tang, H. Cho, K. Chen, R. Mitchell, I. Cano, T. Zhou, M. Li, J. Xie, M. Lin, Y. Geng, Y. Li, and J. Yuan. 2022. <a href="https://CRAN.R-project.org/package=xgboost">Xgboost: Extreme gradient boosting</a>.
</div>
<div id="ref-feret2022package" class="csl-entry" role="listitem">
Féret, J.-B., and F. de Boissieu. 2022. <a href="https://gitlab.com/jbferet/prospect">Prospect: PROSPECT leaf radiative transfer model and inversion routines</a>.
</div>
<div id="ref-feret2008prospect" class="csl-entry" role="listitem">
Féret, J.-B., C. François, G. P. Asner, A. A. Gitelson, R. E. Martin, L. P. Bidel, S. L. Ustin, G. Le Maire, and S. Jacquemoud. 2008. <a href="https://doi.org/10.1016/j.rse.2008.02.012">PROSPECT-4 and 5: Advances in the leaf optical properties model separating photosynthetic pigments</a>. Remote Sensing of Environment 112:3030–3043.
</div>
<div id="ref-gramacy2020surrogates" class="csl-entry" role="listitem">
Gramacy, R. B. 2020. Surrogates: <span>G</span>aussian process modeling, design and &nbsp;optimization for the applied sciences. Chapman Hall/CRC, Boca Raton, Florida.
</div>
<div id="ref-hastie2017extended" class="csl-entry" role="listitem">
Hastie, T., R. Tibshirani, and R. J. Tibshirani. 2017. <a href="https://doi.org/10.48550/arXiv.1707.08692">Extended comparisons of best subset selection, forward stepwise selection, and the lasso</a>. arXiv preprint arXiv:1707.08692.
</div>
<div id="ref-herrmann2010swir" class="csl-entry" role="listitem">
Herrmann, I., A. Karnieli, D. Bonfil, Y. Cohen, and V. Alchanatis. 2010. <a href="https://doi.org/10.1080/01431160903283892">SWIR-based spectral indices for assessing nitrogen content in potato fields</a>. International Journal of Remote Sensing 31:5127–5143.
</div>
<div id="ref-kuhn2022caret" class="csl-entry" role="listitem">
Kuhn, M. 2022. <a href="https://CRAN.R-project.org/package=caret">Caret: Classification and regression training</a>.
</div>
<div id="ref-kuhn2023" class="csl-entry" role="listitem">
Kuhn, M., and R. Quinlan. 2023. <a href="https://CRAN.R-project.org/package=Cubist">Cubist: Rule- and instance-based regression modeling</a>.
</div>
<div id="ref-liaw2002randomForest" class="csl-entry" role="listitem">
Liaw, A., and M. Wiener. 2002. <a href="https://CRAN.R-project.org/doc/Rnews/">Classification and regression by randomForest</a>. R News 2:18–22.
</div>
<div id="ref-liland2022pls" class="csl-entry" role="listitem">
Liland, K. H., B.-H. Mevik, and R. Wehrens. 2022. <a href="https://CRAN.R-project.org/package=pls">Pls: Partial least squares and principal component regression</a>.
</div>
<div id="ref-R2022" class="csl-entry" role="listitem">
R Core Team. 2022. <a href="https://www.R-project.org/">R: A language and environment for statistical computing</a>. R Foundation for Statistical Computing, Vienna, Austria.
</div>
<div id="ref-spafford2021spectral" class="csl-entry" role="listitem">
Spafford, L., G. Le Maire, A. MacDougall, F. De Boissieu, and J.-B. Feret. 2021. <a href="https://doi.org/10.1016/j.rse.2020.112176">Spectral subdomains and prior estimation of leaf structure improves PROSPECT inversion on reflectance or transmittance alone</a>. Remote Sensing of Environment 252:112176.
</div>
<div id="ref-stone1974cross" class="csl-entry" role="listitem">
Stone, M. 1974. <a href="https://doi.org/10.1111/j.2517-6161.1974.tb00994.x">Cross-validatory choice and assessment of statistical predictions</a>. Journal of the royal statistical society: Series B (Methodological) 36:111–133.
</div>
<div id="ref-tian2011assessing" class="csl-entry" role="listitem">
Tian, Y., X. Yao, J. Yang, W. Cao, D. Hannaway, and Y. Zhu. 2011. <a href="https://doi.org/10.1016/j.fcr.2010.11.002">Assessing newly developed and published vegetation indices for estimating rice leaf nitrogen concentration with ground-and space-based hyperspectral reflectance</a>. Field Crops Research 120:299–310.
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Bear in mind that the surrogate model must be re-trained once for each observation, making computational efficiency an important aspect of this step.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./describing-processing-and-inspecting-the-data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Describing, processing and inspecting the data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./results-of-the-model-performances.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Results of the model performances</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">© 2023, Damian Oswald</div>   
    <div class="nav-footer-center">Remote Sensing of Foliar Nitrogen in Californian Almonds (2023)</div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/Damian-Oswald">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/damian-oswald">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="mailto:damian.oswald@protonmail.com">
      <i class="bi bi-envelope-fill" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>



</body></html>