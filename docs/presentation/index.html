<!DOCTYPE html>
<html lang="en"><head>
<script src="index_files/libs/clipboard/clipboard.min.js"></script>
<script src="index_files/libs/quarto-html/tabby.min.js"></script>
<script src="index_files/libs/quarto-html/popper.min.js"></script>
<script src="index_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="index_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="index_files/libs/quarto-html/quarto-syntax-highlighting-e26003cea8cd680ca0c55a263523d882.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.39">

  <meta name="author" content="Damian Oswald">
  <meta name="dcterms.date" content="2024-04-11">
  <title>Remote Sensing of Foliar Nitrogen in Californian Almonds</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for citations */
    div.csl-bib-body { }
    div.csl-entry {
      clear: both;
      margin-bottom: 0em;
    }
    .hanging-indent div.csl-entry {
      margin-left:2em;
      text-indent:-2em;
    }
    div.csl-left-margin {
      min-width:2em;
      float:left;
    }
    div.csl-right-inline {
      margin-left:2em;
      padding-left:1em;
    }
    div.csl-indent {
      margin-left: 2em;
    }  </style>
  <link rel="stylesheet" href="index_files/libs/revealjs/dist/theme/quarto-438d44d913154dbd189e2f81e378bf09.css">
  <link href="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="index_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
  <script src="index_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
  <script src="index_files/libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
  <link href="index_files/libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
  <script src="index_files/libs/leaflet-1.3.1/leaflet.js"></script>
  <link href="index_files/libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
  <script src="index_files/libs/proj4-2.6.2/proj4.min.js"></script>
  <script src="index_files/libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
  <link href="index_files/libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
  <script src="index_files/libs/leaflet-binding-2.2.2/leaflet.js"></script>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Remote Sensing of Foliar Nitrogen in Californian Almonds</h1>
  <p class="subtitle">Master thesis presentation</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Damian Oswald 
</div>
<div class="quarto-title-author-email">
<a href="mailto:damoswa@student.ethz.ch">damoswa@student.ethz.ch</a>
</div>
</div>
</div>

  <p class="date">April 11, 2024</p>
</section><section id="TOC">
<nav role="doc-toc"> 
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#/background" id="/toc-background">Background</a></li>
<li><a href="#/explanation-of-the-data" id="/toc-explanation-of-the-data">Explanation of the data</a></li>
<li><a href="#/leaf-level-radiative-transfer-modelling" id="/toc-leaf-level-radiative-transfer-modelling">Leaf-level radiative transfer modelling</a></li>
<li><a href="#/canopy-level-radiative-transfer-modelling" id="/toc-canopy-level-radiative-transfer-modelling">Canopy-level radiative transfer modelling</a></li>
<li><a href="#/results-of-the-model-performances" id="/toc-results-of-the-model-performances">Results of the model performances</a></li>
<li><a href="#/discussion" id="/toc-discussion">Discussion</a></li>
</ul>
</nav>
</section>
<section>
<section id="background" class="title-slide slide level1 center">
<h1>Background</h1>

</section>
<section id="almonds-and-nitrogen" class="slide level2">
<h2>Almonds and nitrogen</h2>
<ul>
<li>California is the <u>largest producer of almonds</u> with a production share of roughly 80% <span class="citation" data-cites="almonds2020">(<a href="#/references" role="doc-biblioref" onclick="">CDFA 2020</a>)</span>.</li>
</ul>
<div>
<ul>
<li class="fragment"><p>Almonds are a <u>profitable but also intensive crop</u>, where the recommended nitrogen application ranges between 130 and 285 kg N ha<sup>-1</sup> a<sup>-1</sup> <span class="citation" data-cites="nitrogen2020">(<a href="#/references" role="doc-biblioref" onclick="">Brown et al. 2020</a>)</span>.</p></li>
<li class="fragment"><p>Nitrogen leaching <u>negatively impacts ecological systems</u> and can affect the water supply quality <span class="citation" data-cites="yang2008mechanisms">(<a href="#/references" role="doc-biblioref" onclick="">Yang et al. 2008</a>)</span>.</p></li>
<li class="fragment"><p>Remote sensing of crop nitrogen for an adequate fertilization is one of the core promises of <u>precision agriculture</u> <span class="citation" data-cites="walter2017smart">(<a href="#/references" role="doc-biblioref" onclick="">Walter et al. 2017</a>)</span>.</p></li>
</ul>
</div>
</section>
<section id="goal-of-this-thesis" class="slide level2">
<h2>Goal of this thesis</h2>
<ul>
<li>Model the <u>foliar nitrogen concentration based on hyperspectral images</u> or spectroradiometric measurements.</li>
</ul>
<div class="fragment">
<p><span id="eq-task"><span class="math display">\[
f: \boldsymbol \rho \in \mathbb R^{d} \longrightarrow \text{N}_{\%} \in \mathbb R
\tag{1}\]</span></span></p>
</div>
<div class="fragment">
<ul>
<li>Produce a <u>model that is generalizable</u> to datasets from other orchards and other years (and possibly even other crops).</li>
</ul>
</div>
</section>
<section id="modelling-approaches" class="slide level2">
<h2>Modelling approaches</h2>
<p>I was trying out <u>different modelling approaches</u> to predict foliar nitrogen concentration from spectral data.</p>
<div class="fragment fade-in-then-semi-out">
<ul>
<li><u>Hand-crafted</u> features (e.g.&nbsp;vegetation indices).</li>
</ul>
</div>
<div class="fragment fade-in-then-semi-out">
<ul>
<li><u>Machine learning</u> (purely data-driven).</li>
</ul>
</div>
<div class="fragment fade-in">
<ul>
<li>Modelling <u>physical processes</u> using radiative transfer models.</li>
</ul>
</div>
<div class="fragment">
<p>For this presentation, the focus will heavily lie on radiative transfer models.</p>
</div>
</section></section>
<section>
<section id="explanation-of-the-data" class="title-slide slide level1 center">
<h1>Explanation of the data</h1>

</section>
<section id="location-of-the-almond-orchard" class="slide level2">
<h2>Location of the almond orchard</h2>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-eaa87fc9ca38ebb2b662" style="width:1050px;height:550px;" class="leaflet html-widget"></div>
<script type="application/json" data-for="htmlwidget-eaa87fc9ca38ebb2b662">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"addTiles","args":["https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",null,null,{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"attribution":"&copy; <a href=\"https://openstreetmap.org/copyright/\">OpenStreetMap<\/a>,  <a href=\"https://opendatacommons.org/licenses/odbl/\">ODbL<\/a>"}]},{"method":"addMarkers","args":[38.66722,-121.88989,null,null,null,{"interactive":true,"draggable":false,"keyboard":true,"title":"","alt":"","zIndexOffset":0,"opacity":1,"riseOnHover":false,"riseOffset":250},"Westfield almond orchard",null,null,null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"setView":[[38.66722,-121.88989],7,[]],"limits":{"lat":[38.66722,38.66722],"lng":[-121.88989,-121.88989]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="hyperspectral-data" class="slide level2">
<h2>Hyperspectral data</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Orthomosaic.jpg" class="r-stretch quarto-figure-center" id="fig-orthomosaic"><p class="caption">
Figure&nbsp;1: Westwind almond orchard in Woodland, CA (<em>left</em>). Explanation of hyperspectral images (<em>right</em>).
</p></section>
<section id="pre-processing-of-the-data" class="slide level2">
<h2>Pre-processing of the data</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Segmentation.png" class="r-stretch quarto-figure-center" id="fig-segmentation"><p class="caption">
Figure&nbsp;2: Segmentation process to extract the mean spectral reflectance from the hyperspectral images.
</p></section>
<section id="irradiance-radiance-and-reflectance" class="slide level2">
<h2>Irradiance, radiance, and reflectance</h2>
<div class="r-stack">
<p><img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Electromagnetic_02.png"></p>
<p><img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Electromagnetic_03.png" class="fragment"></p>
<p><img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Electromagnetic_04.png" class="fragment"></p>
</div>
<!-- ![](https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Electromagnetic_01.png){.fragment} -->
<!-- ::: -->
</section>
<section id="overview-of-the-data-sets" class="slide level2">
<h2>Overview of the data sets</h2>
<p><u>Leaf-level and canopy-level data</u> was used for this thesis, both referring to the same target trees.</p>
<div class="fragment">
<div id="tbl-data" class="quarto-float quarto-figure quarto-figure-center" data-tbl-colwidths="[25,25,25,30,30]">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Overview of the two datasets used.
</figcaption>
<div aria-describedby="tbl-data-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top">
<colgroup>
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 19%">
<col style="width: 22%">
<col style="width: 22%">
</colgroup>
<thead>
<tr class="header">
<th><strong>Level</strong></th>
<th><strong>Observations</strong></th>
<th><strong>Bands</strong></th>
<th><strong>Range</strong></th>
<th><strong>Sensor</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Leaf</td>
<td>124</td>
<td>1024</td>
<td>338 - 2512 nm</td>
<td>HR-1024i</td>
</tr>
<tr class="even">
<td>Canopy</td>
<td>107</td>
<td>151</td>
<td>385 - 900 nm</td>
<td>Pika L</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</div>
<!-- ## Correlations -->
<!-- ![Correlation matrices of canopy- and leaf-level datasets (**A**) as well as band-wise correlations to the measured foliar nitrogen concentration (**B**).](https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/exploratory.png){#fig-exploratory} -->
</section></section>
<section>
<section id="leaf-level-radiative-transfer-modelling" class="title-slide slide level1 center">
<h1>Leaf-level radiative transfer modelling</h1>

</section>
<section id="the-prospect-model" class="slide level2">
<h2>The <span class="smallcaps">Prospect</span> model</h2>
<ul>
<li><span class="smallcaps">Prospect</span> (leaf optical property spectra) is a radiative transfer model first introduced by <span class="citation" data-cites="jacquemoud1992utilisation">Jacquemoud (<a href="#/references" role="doc-biblioref" onclick="">1992</a>)</span>.</li>
</ul>
<div class="fragment">
<ul>
<li>It <u>simulates the reflectance and transmittance</u> of a leaf given the <u>content of plant pigments</u> (and some other plant parameters). <span id="eq-prospectpro"><span class="math display">\[
f: [\mathbf c, N, \alpha] \in \mathbb R^{9} \rightarrow [\boldsymbol \rho, \boldsymbol \tau] \in \mathbb R^{2\times 2101}
\tag{2}\]</span></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The function <span class="math inline">\(f\)</span> is constructed from <u>established laws of physics</u>.</li>
</ul>
</div>
</section>
<section id="the-parameters-of-prospect" class="slide level2">
<h2>The parameters of <span class="smallcaps">Prospect</span></h2>
<div id="tbl-SAC" class="quarto-float quarto-figure quarto-figure-center" data-tbl-colwidths="[5,10,90,20]">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-SAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Input variables of the <span class="smallcaps">Prospect</span> model as documented by <span class="citation" data-cites="feret2022package">Feret and de Boissieu (<a href="#/references" role="doc-biblioref" onclick="">2022</a>)</span>.
</figcaption>
<div aria-describedby="tbl-SAC-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="caption-top">
<colgroup>
<col style="width: 4%">
<col style="width: 8%">
<col style="width: 72%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Abbreviation</th>
<th></th>
<th>Parameter</th>
<th>Unit</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><br>
<br>
<br>
<span class="math inline">\(\mathbf c\)</span></td>
<td><code>CHL</code><br>
<code>CAR</code><br>
<code>ANT</code><br>
<code>BROWN</code><br>
<code>EWT</code><br>
<code>PROT</code><br>
<code>CBC</code></td>
<td><strong>Chlorophyll content</strong><br>
Carotenoid content<br>
Anthocyanin content<br>
Tannin content<br>
Equivalent water thickness<br>
<strong>Protein content</strong><br>
Carbon-based constituent content</td>
<td><span class="math inline">\(\mu \text{g cm}^{-2}\)</span><br>
<span class="math inline">\(\mu \text{g cm}^{-2}\)</span><br>
<span class="math inline">\(\mu \text{g cm}^{-2}\)</span><br>
<span class="math inline">\(-\)</span><br>
<span class="math inline">\(\text{g cm}^{-2}\)</span><br>
<span class="math inline">\(\text{g cm}^{-2}\)</span><br>
<span class="math inline">\(\text{g cm}^{-2}\)</span></td>
</tr>
<tr class="even">
<td><span class="math inline">\(N\)</span></td>
<td><code>N</code></td>
<td>Leaf mesophyll structure parameter</td>
<td></td>
</tr>
<tr class="odd">
<td><span class="math inline">\(\alpha\)</span></td>
<td><code>alpha</code></td>
<td>Solid angle for incident light at surface of leaf</td>
<td><span class="math inline">\(^{\circ}\)</span></td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="physics-behind-prospect" class="slide level2 smaller scrollable">
<h2>Physics behind <span class="smallcaps">Prospect</span></h2>
<p>We start out with equations describing s- and p-polarized transmission and reflection by <span class="citation" data-cites="fresnel1821">Fresnel (<a href="#/references" role="doc-biblioref" onclick="">1821</a>)</span>, where <span class="math inline">\(n\)</span> is the refractive index. <span id="eq-fresnel"><span class="math display">\[
\scriptstyle
t_s(\theta, n) = \frac{4\sqrt{1-\sin^2 \theta} \sqrt{n^2-\sin^2 \theta}}{\left(\sqrt{1-\sin^2 \theta} + \sqrt{n^2-\sin^2 \theta}\right)^2}
\qquad
t_p(\theta, n) = \frac{4n^2\sqrt{1-\sin^2 \theta} \sqrt{n^2-\sin^2 \theta}}{\left(n^2\sqrt{1-\sin^2 \theta} + \sqrt{n^2-\sin^2 \theta}\right)^2}
\tag{3}\]</span></span> We are interested in the transmissivity for diffuse light coming from all angles <span class="math inline">\(\theta\)</span> between <span class="math inline">\(0\)</span> and <span class="math inline">\(\frac{\pi}{2}\)</span>. <span id="eq-integration"><span class="math display">\[
\scriptstyle
\overline{T} = \frac{\int_0^{2\pi} d\varphi \int_0^{\alpha} t(\theta,n) \cos \theta \sin\theta d \theta}{\int_0^{2\pi} d\varphi \int_0^{\alpha}  \cos \theta \sin\theta d \theta}
\tag{4}\]</span></span> The Fresnel equations were integrated by <span class="citation" data-cites="allen1973transmission">Allen (<a href="#/references" role="doc-biblioref" onclick="">1973</a>)</span> for a general case of the maximum incidence angle <span class="math inline">\(\alpha\)</span>, both for s-polarized transmissivity:</p>
<p><span id="eq-Ts"><span class="math display">\[
\scriptstyle
\begin{aligned}
T_s(\alpha, n) =
\frac{1}{96}\frac{(n^2-1)^4}{\left[\sqrt{\left(\sin^2 \alpha -\frac{1}{2} (n^2 + 1)\right)^2 -\frac{1}{4} (n^2 - 1)^2} - \sin^2 \alpha +\frac{1}{2}  (n^2 + 1)\right]^3} -
\\\
\frac{1}{4}\frac{n^4 - 2n^2 +1}{\sqrt{\left(\sin^2 \alpha -\frac{1}{2} (n^2 + 1)\right)^2 -\frac{1}{4} (n^2 - 1)^2} - \sin^2 \alpha + \frac{1}{2} (n^2 + 1)} -
\\\
\frac{1}{2} \left( \sqrt{\left(\sin^2 \alpha -\frac{1}{2} (n^2 + 1)\right)^2 -\frac{1}{4} (n^2 - 1)^2} - \sin^2 \alpha + \frac{1}{2} (n^2 + 1) \right) +
\\\
\frac{1}{12} \frac{(n^2 - 1)^4}{(n + 1)^6} + \frac{1}{2} \frac{(n^2-1)^2}{(n+1)^2} + \frac{1}{4} (n^2+2n+1)
\end{aligned}
\tag{5}\]</span></span></p>
<p>As well as for p-polarized transmissivity:</p>
<p><span id="eq-Tp"><span class="math display">\[
\scriptstyle
\begin{aligned}
T_p(\alpha, n) =
\frac{-2 n^2}{(n^2 + 1)^2} \left[ \sqrt{\left(\sin^2 \alpha - \frac{1}{2} (n^2 + 1)\right)^2 - \frac{1}{4} (n^2 - 1)^2} - \sin^2 \alpha + \frac{1}{2} (n^2 + 1) - \frac{1}{2} (n + 1)^2 \right] -
\\\
\frac{2  n^2  (n^2 + 1)}{(n^2-1)^2}  \cdot \ln \left[ \sqrt{\left(\sin^2 \alpha - \frac{1}{2} (n^2 + 1)\right)^2 - \frac{1}{4} (n^2 - 1)^2} -
\frac{\sin^2 \alpha - \frac{1}{2}(n^2 + 1)}{(n+1)^2}
\right] +
\\\
\frac{1}{2} n^2 \left\{ \left[ \sqrt{\left(\sin^2 \alpha - \frac{1}{2} (n^2 + 1)\right)^2 - \frac{1}{4} (n^2 - 1)^2} - \sin^2\alpha - \frac{1}{2} (n^2 + 1)\right]^{-1} - \frac{2}{(n + 1)^2} \right\} +
\\
\frac{16n^4 (n^4 + 1)}{(n^2+1)^3(n^2-1)^2} \cdot \ln \left[\frac{
2 (n^2 + 1)  \left(\sqrt{\left(\sin^2 \alpha - \frac{1}{2} (n^2 + 1)\right)^2} - \sin^2 \alpha + \frac{1}{2}  (n^2 + 1)\right)
- (n^2 - 1)^2}{(n^2 + 1)(n + 1)^2  - (n^2-1)^2} \right] +
\\\
\frac{16 n^6}{(n^2 + 1)^3} \left[
{2 (n^2 + 1)  \left(\sqrt{\left(\sin^2 \alpha - \frac{1}{2} (n^2 + 1)\right)^2} - \sin^2 \alpha + \frac{1}{2}  (n^2 + 1)\right)
- (n^2 - 1)^2} \right]^{-1} -
\\\
\frac{16n^6}{(n^2 + 1)^3\left( (n^2 + 1)   (n + 1)^2 - (n^2 - 1)^2 \right)}
\end{aligned}
\tag{6}\]</span></span></p>
<p>Combine the two above to get the average transmissivity <span class="math inline">\(\overline{T}\)</span> as a function of <span class="math inline">\(\alpha\)</span> and <span class="math inline">\(n\)</span>.</p>
<p><span id="eq-Tav"><span class="math display">\[
\scriptstyle
\overline{T}(\alpha, n) = \frac{T_s(\alpha, n) + T_p(\alpha, n)}{2 \cdot \sin^2 \alpha}
\tag{7}\]</span></span></p>
<p>The overall absorption coefficients <span class="math inline">\(k\)</span> of a wavelength <span class="math inline">\(\lambda\)</span> can be calculated as a weighted sum of specific absorption coefficients <span class="math inline">\(s\)</span>, where the weights are the content of the plant pigments. These specific absorption coefficients were empirically estimated by <span class="citation" data-cites="feret2021prospect">Féret et al. (<a href="#/references" role="doc-biblioref" onclick="">2021</a>)</span>.</p>
<p><span id="eq-k"><span class="math display">\[
\scriptstyle
k_\lambda = \frac{1}{N} \sum_i c_i s_{i,\lambda}
\tag{8}\]</span></span></p>
<p>Given this coefficient vector, we can calculate the transmission for isotropic light <span class="math inline">\(\varphi\)</span> for every wavelength <span class="math inline">\(\lambda\)</span> with <span class="math inline">\(k = k_\lambda\)</span> using the upper incomplete gamma function according to the Beer-Lambert law <span class="citation" data-cites="lambert1760photometria beer1852bestimmung">(<a href="#/references" role="doc-biblioref" onclick="">Lambert 1760</a>; <a href="#/references" role="doc-biblioref" onclick="">Beer 1852</a>)</span>.</p>
<p><span id="eq-phi"><span class="math display">\[
\scriptstyle
\varphi =
(1 - k) \cdot e^{-k} + k^2 \cdot \Gamma(k) =
(1 - k) \cdot e^{-k} + k^2 \cdot \int_k^\infty \frac{e^{-t}}{t} dt
\tag{9}\]</span></span></p>
<p>Given all of the equations above, <span class="citation" data-cites="jacquemoud1992utilisation">Jacquemoud (<a href="#/references" role="doc-biblioref" onclick="">1992</a>)</span> wrote the first implementation of the <span class="smallcaps">Prospect</span> model. <span id="eq-substitutions"><span class="math display">\[
\scriptstyle
\begin{aligned}
A = \frac{ \varphi \: \overline T(90, n)} { n^2\left[1 - \varphi^2 \: \left(1 - n^{-2} \: \overline T(90, n) \right)^2\right] }
\qquad
B = \overline T(90, n) \: A
\\[15pt]
C = 1 - \overline T(90, n) + \varphi \: B \: \left(1 - \frac{\overline T(90, n)}{n^2}\right)
\\[15pt]
D = \sqrt{(1 + C + B) \: (1 + C - B) \: (1 - C + B) \: (1 - C - B)}
\qquad
E = \frac{1 + C^2 - B^2 + D}{2\,C}
\\[15pt]
F = \frac{1 - C^2 + B^2 + D}{2\,B}
\qquad
G = F^{N-1}
\qquad
H = \frac{E \, (G^2 - 1)}{E^2 \, G^2 - 1}
\end{aligned}
\tag{10}\]</span></span> Everything can be put together to get the spectral reflectance <span class="math inline">\(\rho\)</span> and transmittance <span class="math inline">\(\tau\)</span> of a leaf. <span id="eq-rho"><span class="math display">\[
\scriptstyle
\rho = 1 - \overline T(\alpha, n) \left[ 1 + \varphi \, A \left(1 - \frac{\overline T(90, n)}{n^2}  \right) + \frac{A \, H \, B}{1 - H \, C}  \right]
\tag{11}\]</span></span> <span id="eq-tau"><span class="math display">\[
\scriptstyle
\tau =  \frac{\overline T(\alpha, n) \, A \, G \, (E^2 - 1)}{(E^2 \, G^2 - 1) \, (1 - H \, C)}
\tag{12}\]</span></span></p>
</section>
<section id="interactive-demonstration" class="slide level2">
<h2>Interactive demonstration</h2>
<iframe id="scaled-frame" width="100%" height="100%" frameborder="no" src=" https://damiansmasterthesis.shinyapps.io/shinyapp/">
</iframe>
</section>
<section id="the-inversion-problem" class="slide level2">
<h2>The inversion problem</h2>
<ul>
<li>Radiative transfer models are constructed in the <u>forward mode</u>: we calculate the reflectance given leaf parameters.</li>
</ul>
<div class="fragment">
<ul>
<li>In reality, we are dealing with the <u>inverse problem</u>: we already know the reflectance, but want to find the parameters. This is called the <u>backward mode</u>. <span id="eq-inversion"><span class="math display">\[
f: x \to y \qquad \qquad f^{-1}: y \to x
\tag{13}\]</span></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The inversion can be achieved via (1) <u>optimization</u>, (2) a <u>look-up table</u> or (3) <u>machine learning</u>.</li>
</ul>
</div>
</section></section>
<section>
<section id="canopy-level-radiative-transfer-modelling" class="title-slide slide level1 center">
<h1>Canopy-level radiative transfer modelling</h1>

</section>
<section id="the-less-model" class="slide level2">
<h2>The <span class="smallcaps">Less</span> model</h2>
<ul>
<li>The <span class="smallcaps">Less</span> model (large-scale emulation system for forest simulation) is a <u>ray tracing model</u> developed by <span class="citation" data-cites="qi2019less">Qi et al. (<a href="#/references" role="doc-biblioref" onclick="">2019</a>)</span>.</li>
</ul>
<div class="fragment">
<ul>
<li>It simulates a <u>three-dimensional scene</u> given the spectral reflectance of every material used.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="smallcaps">Less</span> is <u>computationally much more intensive</u> than <span class="smallcaps">Prospect</span> and also includes many more parameters.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>The inversion of <span class="smallcaps">Less</span> was achieved using a <u>look-up table</u>.</li>
</ul>
<!-- ## Simulated parameters -->
<!-- The generated look-up table for the canopy-level reflectance is based on 16'000 distinct simulation runs of [Less]{.smallcaps}. -->
<!-- | Parameter              | Values                                                             | -->
<!-- | ---------------------- | ------------------------------------------------------------------ | -->
<!-- | Chlorophyll            | {20.0, 22.5, 25.0, 27.5, 30.0, 32.5, 35.0, 37.5, 40.0, 42.5 45.0}  | -->
<!-- | Anthocyanin            | {2.75, 3.00, 3.25, 3.5, 3.75}                                      | -->
<!-- | Carotenoid             | {2.0, 3.0, 4.0, 5.0, 6.0}                                          | -->
<!-- | Dry matter             | {0.006, 0.007, 0.008, 0.009, 0.010}                                | -->
<!-- | Leaf area index        | {1,2,3,4,5,6,7,8,9,10,11,12,13,14,15}                              | -->
<!-- : The look-up table generated with [Less]{.smallcaps}. {#tbl-Less} -->
</div>
</section>
<section id="modelling-the-orchard-scene" class="slide level2">
<h2>Modelling the orchard scene</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Less3dExplanation.png" class="r-stretch quarto-figure-center" id="fig-Less1"><p class="caption">
Figure&nbsp;3: The preliminarily used three-dimensional model of an almond tree (<strong>A</strong>) and how it is arranged to represent a tree in the orchard (<strong>B</strong>).
</p></section>
<section id="observation-vs.-simulation" class="slide level2">
<h2>Observation vs.&nbsp;simulation</h2>

<!-- ## How this looks in an image -->
<!-- ![Spatial reflectance given only reflectance information from one single wavelength.](https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Reflectance.gif) -->
<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/LessSimulatedObserved.png" class="r-stretch quarto-figure-center" id="fig-Less2"><p class="caption">
Figure&nbsp;4: An RGB representation of the hyperspectral data which was observed (<strong>C</strong>) compared to the one that was simulated (<strong>D</strong>).
</p></section>
<section id="look-up-table-regression" class="slide level2">
<h2>Look-up-table regression</h2>
<ul>
<li>Generated a look-up table containing <u>16’500 simulations</u>.</li>
</ul>
<div class="fragment">
<ul>
<li>Given one observation, we <u>find its closest match</u> in the look-up table by minimizing a cost function <span class="math inline">\(J\)</span>. <span id="eq-LUTminimization"><span class="math display">\[
J =  \frac{1}{d} \sum_{\lambda=1}^d w_i\left( \rho_{\lambda,\text{obs.}} - \rho_{\lambda,\text{sim.}} \right)^2
\tag{14}\]</span></span></li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Make smooth predictions by applying <u>hyper-dimensional interpolation</u> (multicubic polynomial surrogate model).</li>
</ul>
</div>
</section></section>
<section>
<section id="results-of-the-model-performances" class="title-slide slide level1 center">
<h1>Results of the model performances</h1>

</section>
<section id="leaf-level-results-area-based-n" class="slide level2">
<h2>Leaf level results (area-based N)</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Results_SRM_N_area.png" class="r-stretch quarto-figure-center" id="fig-resultsSRM"><p class="caption">
Figure&nbsp;5: Results based on a 50 times repeated 20-fold cross validation.
</p></section>
<section id="leaf-level-results-mass-based-n" class="slide level2">
<h2>Leaf level results (mass-based N)</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Results_SRM.png" class="r-stretch quarto-figure-center" id="fig-resultsSRM"><p class="caption">
Figure&nbsp;6: Results based on a 50 times repeated 20-fold cross validation.
</p></section>
<section id="canopy-level-results" class="slide level2">
<h2>Canopy level results</h2>

<img data-src="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/Results_HSI.png" class="r-stretch quarto-figure-center" id="fig-resultsHSI"><p class="caption">
Figure&nbsp;7: Results based on a 50 times repeated 20-fold cross validation.
</p></section></section>
<section>
<section id="discussion" class="title-slide slide level1 center">
<h1>Discussion</h1>

</section>
<section id="machine-learning-or-physics" class="slide level2">
<h2>Machine learning or physics?</h2>
<ul>
<li>Machine learning models <u>work well, but they tend not to be robust</u> if applied to settings outside their training data.</li>
</ul>
<div class="fragment">
<ul>
<li><u>Physics-based models may provide this robustness</u> while maintaining a similar level of accuracy <span class="citation" data-cites="berger2018evaluation">(<a href="#/references" role="doc-biblioref" onclick="">Berger et al. 2018</a>)</span>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>These models also <u>push the understanding</u> of the subject more than machine learning models do.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Machine learning serves well as an indicator of <u>what level of accuracy should be expected</u>.</li>
</ul>
</div>
</section>
<section id="range-of-the-nitrogen-measurements" class="slide level2">
<h2>Range of the nitrogen measurements</h2>
<ul>
<li>Data set covers a commercial almond orchard <u>fertilized according to the recommendations</u>. The measured N<sub>%</sub> ranges between 1.96 and 3.17%.</li>
</ul>
<div class="fragment">
<ul>
<li>Much of the published research focuses on fertilization trials, where <u>nitrogen deficiency is artificially induced</u>.</li>
</ul>
</div>
<div class="fragment">
<!-- - Focusing on mass-based nitrogen on a leaf level gives a [wrong impression of the accuracy]{.underline}, as it's tightly connected to the leaf mass. -->
<ul>
<li>Healthy distrust of nitrogen measurements – they are <u>no absolute ground truth</u>.</li>
</ul>
</div>
</section>
<section id="improving-canopy-level-predictions" class="slide level2">
<h2>Improving canopy-level predictions</h2>
<ul>
<li>Include <u>information in the short-wave infrared spectrum</u> from more advanced sensors.</li>
</ul>
<div class="fragment">
<!-- - Satellite imagery is constantly improving in [spectral, spatial and temporal resolution]{.underline} [@berger2020crop]. -->
<ul>
<li><u>Spatial information</u> can be combined with spectral information to predict foliar nitrogen concentrations.</li>
</ul>
</div>
</section>
<section id="conclusion" class="slide level2">
<h2>Conclusion</h2>
<ul>
<li>Nitrogen remote sensing research should focus on crops that are <u>fertilized according to standard practice</u>.</li>
</ul>
<div class="fragment">
<ul>
<li>Radiative transfer models are promising as a robust method of <u>estimating plant traits</u> which can be connected to N<sub>%</sub>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li><span class="smallcaps">Prospect</span> predictions shows discrepancies with observed data: chlorophyll could be <u>split into chlorophyll a and b</u>.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Spectral resolution is not that important – but the range covered is (especially <u>short-wave infrared</u>).</li>
</ul>
</div>
</section>
<section id="section" class="slide level2" data-background-video="https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/westwind.mp4">
<h2></h2>
</section>
<section id="references" class="slide level2 smaller scrollable">
<h2>References</h2>
<!-- ## The role of nitrogen in plant leaves -->
<!-- ![Nitrogen as key component of biomass and its proportional allocation in a C~3~ plant leaf. Adapted from @chapin1987plant.](https://raw.githubusercontent.com/Damian-Oswald/master-thesis/refs/heads/main/presentation/resources/NitrogenInPlants.png){#fig-NitrogenInPlants} -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-allen1973transmission" class="csl-entry" role="listitem">
Allen, William A. 1973. <span>“Transmission of Isotropic Light Across a Dielectric Surface in Two and Three Dimensions.”</span> <em>JOSA</em> 63 (6): 664–66. <a href="https://doi.org/10.1364/JOSA.63.000664">https://doi.org/10.1364/JOSA.63.000664</a>.
</div>
<div id="ref-beer1852bestimmung" class="csl-entry" role="listitem">
Beer, August. 1852. <span>“Bestimmung Der Absorption Des Rothen Lichts in Farbigen Flussigkeiten.”</span> <em>Ann. Physik</em> 162: 78–88.
</div>
<div id="ref-berger2018evaluation" class="csl-entry" role="listitem">
Berger, Katja, Clement Atzberger, Martin Danner, Guido D’Urso, Wolfram Mauser, Francesco Vuolo, and Tobias Hank. 2018. <span>“Evaluation of the PROSAIL Model Capabilities for Future Hyperspectral Model Environments: A Review Study.”</span> <em>Remote Sensing</em> 10 (1): 85. <a href="https://doi.org/10.3390/rs10010085">https://doi.org/10.3390/rs10010085</a>.
</div>
<div id="ref-nitrogen2020" class="csl-entry" role="listitem">
Brown, Patrick H., Sebastian Saa, Saiful Muhammad, and Sat Darshan Khalsa. 2020. <span>“Nitrogen Best Management Practices.”</span> 1150 Ninth Street, Suite 1500, Modesto, CA 95354: Almond Board of California.
</div>
<div id="ref-almonds2020" class="csl-entry" role="listitem">
CDFA. 2020. <span>“California Agriculture Exports 2019-2020.”</span> 1220 N Street, Sacramento, CA 95812: <span>California Department of Food and Argiculture</span>.
</div>
<div id="ref-feret2022package" class="csl-entry" role="listitem">
Feret, Jean-Baptiste, and Florian de Boissieu. 2022. <em>Prospect: PROSPECT Leaf Radiative Transfer Model and Inversion Routines</em>. <a href="https://gitlab.com/jbferet/prospect">https://gitlab.com/jbferet/prospect</a>.
</div>
<div id="ref-feret2021prospect" class="csl-entry" role="listitem">
Féret, Jean-Baptiste, Katja Berger, Florian De Boissieu, and Zbyněk Malenovskỳ. 2021. <span>“PROSPECT-PRO for Estimating Content of Nitrogen-Containing Leaf Proteins and Other Carbon-Based Constituents.”</span> <em>Remote Sensing of Environment</em> 252: 112173. <a href="https://doi.org/10.1016/j.rse.2020.112173">https://doi.org/10.1016/j.rse.2020.112173</a>.
</div>
<div id="ref-fresnel1821" class="csl-entry" role="listitem">
Fresnel, Augustin. 1821. <span>“Note Sur Le Calcul Des Teintes Que La Polarisation d<span>é</span>veloppe Dans Leslames Cristallis<span>é</span>es.”</span> <em>Annales de Chimie Et de Physique</em> 17 (2): 102–11.
</div>
<div id="ref-jacquemoud1992utilisation" class="csl-entry" role="listitem">
Jacquemoud, Stéphane. 1992. <span>“Utilisation de La Haute Resolution Spectrale Pour l’etude Des Couverts Vegetaux: Developpement d’un Modele de Reflectance Spectrale.”</span> PhD thesis, Universit<span>é</span> Paris Diderot-Paris 7.
</div>
<div id="ref-lambert1760photometria" class="csl-entry" role="listitem">
Lambert, Johann Heinrich. 1760. <em>Photometria Sive de Mensura Et Gradibus Luminis, Colorum Et Umbrae</em>. Sumptibus vidvae E. Klett, typis CP Detleffsen.
</div>
<div id="ref-qi2019less" class="csl-entry" role="listitem">
Qi, Jianbo, Donghui Xie, Tiangang Yin, Guangjian Yan, Jean-Philippe Gastellu-Etchegorry, Linyuan Li, Wuming Zhang, Xihan Mu, and Leslie K Norford. 2019. <span>“LESS: LargE-Scale Remote Sensing Data and Image Simulation Framework over Heterogeneous 3D Scenes.”</span> <em>Remote Sensing of Environment</em> 221: 695–706. <a href="https://doi.org/10.1016/j.rse.2018.11.036">https://doi.org/10.1016/j.rse.2018.11.036</a>.
</div>
<div id="ref-walter2017smart" class="csl-entry" role="listitem">
Walter, Achim, Robert Finger, Robert Huber, and Nina Buchmann. 2017. <span>“Smart Farming Is Key to Developing Sustainable Agriculture.”</span> <em>Proceedings of the National Academy of Sciences</em> 114 (24): 6148–50. <a href="https://doi.org/10.1073/pnas.1707462114">https://doi.org/10.1073/pnas.1707462114</a>.
</div>
<div id="ref-yang2008mechanisms" class="csl-entry" role="listitem">
Yang, Xiao-e, Xiang Wu, Hu-lin Hao, and Zhen-li He. 2008. <span>“Mechanisms and Assessment of Water Eutrophication.”</span> <em>Journal of Zhejiang University Science B</em> 9 (3): 197–209. <a href="https://doi.org/10.1631/jzus.B0710626">https://doi.org/10.1631/jzus.B0710626</a>.
</div>
</div>
</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Remote sensing of foliar nitrogen in Californian almonds</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="index_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="index_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="index_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="index_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="index_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="index_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="index_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="index_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>